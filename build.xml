<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE project PUBLIC "-//ANT//DTD project//EN" "misc/project.dtd" >

<project name="Omp" default="main" basedir=".">
  
  <!-- ==================================================== -->
  <!--             OMP -QT BUILD TOOL-                      -->
  <!-- ==================================================== -->
  <taskdef name="modificationset" classname="net.sourceforge.cruisecontrol.ModificationSet"/>
  <taskdef name="junit" classname="org.apache.tools.ant.taskdefs.optional.junit.JUnitTask" />

  <!-- ================================================ -->
  <!--   Set the properties related to the source tree  -->
  <!-- ================================================ -->
<!--    <property name="build.sysclasspath" value="first"/> -->

  <property name="build.compiler" value="jikes"/>
  <property name="build.compiler.emacs" value="true"/>    
  <property name="masterbuild.logdir" value="/home/mrippa/tmp/logs"/>
  <property name="junit.results" value="test-results" />

  <property name="cvs.repository" value="/jac_sw/cvsroot"/>
  <property name="cvs.package" value="omp/QT"/>
  <property name="cvs.workingcopy" value="" />

  <property name="Name" value="QT"/>
  <property name="name" value="qt"/>
  <property name="src.dir" value="src"/>
  <property name="lib.dir" value="lib"/>
  <property name="config.dir" value="config"/>
  <property name="icons.dir" value="icons"/>
  <property name="bin.dir" value="bin"/>
  <property name="java.dir" value="${src.dir}/main"/>
  <property name="tests.dir" value="src/testcases"/>
  <property name="manifest" value="src/etc/manifest"/>
  
  <!--    ==================================================== -->
  <!--       Set the properties for the build area             -->
  <!--    ==================================================== -->
  <property name="build.dir" value="/jac_sw/OMP/${Name}"/>
  <property name="build.classes" value="${build.dir}/classes"/>
  <property name="build.config" value="${build.dir}/config"/>
  <property name="build.icons" value="${build.dir}/icons"/>
  <property name="build.bin" value="${build.dir}/bin"/>
  <property name="build.lib" value="${build.dir}/lib"/>
  <property name="build.javadocs" value="${build.dir}/javadocs"/>
  <property name="build.tests" value="${build.dir}/testcases"/>

  <path id="classpath">
    <!--      <pathelement location="${java.class.path}"/> -->
  </path>
  
  <path id="runpath">
    <!--      <pathelement location="${build.classes}" /> -->
    <!--      <pathelement location="${build.tests}" /> -->
    <!--      <path refid="classpath"/> -->
    <!--      <fileset dir="/home/mrippa/local/cc/lib"/> -->
    <!--        <include name="*.jar"/> -->
    <!--      </filesset> -->
  </path>
  
  <path id="tests-classpath">
    <!--      <pathelement location="${build.classes}" /> -->
    <!--      <pathelement location="${build.tests}" /> -->
    <!--      <path refid="classpath"/> -->
  </path>
  
  <!--    ==================================================== -->
  <!--                  Prepare the Build                      -->
  <!--    ==================================================== -->
  <target name="init">
    <tstamp />
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${build.classes}"/>
    <mkdir dir="${build.lib}"/>
    <mkdir dir="${build.icons}"/>
    <mkdir dir="${build.bin}"/>
    <mkdir dir="${build.config}"/>
    <mkdir dir="${masterbuild.logdir}"/>
  </target>

  <!--    ==================================================== -->
  <!--                  Check Dependencies                     -->
  <!--    ==================================================== -->
  <target name="mkdeps" depends="init">
    <depend srcdir="${java.dir}/"
	    destdir="${build.classes}"
	    cache="depcache"
	    closure="yes"/>
  </target>

  <!--    ================================================ -->
  <!--                   Compile testcases                 -->
  <!--    ================================================ -->
  <target name="compile-tests" depends="compile">
    <mkdir dir="${build.tests}"/>

    <javac srcdir="${tests.dir}"
	   destdir="${build.tests}"
	   debug="${debug}"
	   deprecation="${deprecation}" >
      <classpath>
	<pathelement location="${build.classes}" />
	<fileset dir="${build.lib}">
	  <include name="xerces.jar"/>
	</fileset>
      </classpath>

    </javac>
  </target>

  <!--    ==================================================== -->
  <!--               Get the source from CVS                   -->
  <!--    ==================================================== -->
  <target name="checkout" description="Update package from CVS">
    <cvs cvsroot="${cvs.repository}" 
	 package="${cvs.package}" 
	 dest=".." />
  </target>

  <!--    ====================================================
  *                             Modset                          
  *       ==================================================== -->
  <target name="modificationset" 
	  depends="init" 
	  description="Check modifications since last build">
    <echo message="Checking for modifications..."/>
    <modificationset lastbuild="${lastGoodBuildTime}" 
		     quietperiod="30" 
		     dateformat="yyyy-MMM-dd HH:mm:ss">
      <cvselement cvsroot="${cvs.repository}"
		  localworkingcopy="."/>
    </modificationset>
  </target>

  <!--    ====================================================
  *                             MasterBuild                          
  *       ==================================================== -->
  <target name="masterbuild" 
	  depends="modificationset,checkout,compile,run-tests,jar" 
	  description="Cruise control master build">
  </target>

  <!--    ==================================================== -->
  <!--                      Build It!                          -->
  <!--    ==================================================== -->
  <target name="compile" depends="mkdeps">
    <javac srcdir="${java.dir}/" 
	   destdir="${build.classes}" 
	   debug="on">
      <exclude name="qt/gui/JCheckBoxWidget.java"/>
      <classpath>
	<pathelement location="/home/mrippa/netroot/src/orac3/OT/install/classes" />
	<pathelement location="/home/mrippa/netroot/src/orac3/GEMINI/install/classes" />
	<pathelement location="/home/mrippa/netroot/src/orac3/OM/install/classes" />
	<pathelement location="/home/mrippa/netroot/src/orac3/ORAC/install/classes" />
	<fileset dir="${lib.dir}">
	  <include name="*.jar"/>
	</fileset>
      </classpath>
    </javac>

    <copy todir="${build.lib}">
      <fileset dir="${lib.dir}">
        <include name="*.jar" />
      </fileset>
    </copy>

    <copy todir="${build.config}">
      <fileset dir="${config.dir}">
        <include name="**/*" />
      </fileset>
    </copy>

    <copy todir="${build.icons}">
      <fileset dir="${icons.dir}">
        <include name="*" />
      </fileset>
    </copy>

    <copy todir="${build.bin}">
      <fileset dir="${bin.dir}">
        <include name="*" />
      </fileset>
    </copy>

    <chmod perm="+x">
      <fileset dir="${build.bin}">
        <include name="*" />
      </fileset>
    </chmod>


  </target>

  <!--    ==================================================== -->
  <!--                     Run It!                             -->
  <!--    ==================================================== -->
  <target name="run" depends="compile">
    <java classname="edu.jach.qt.app.Main" fork="yes">
      <!--        <classpath path="${build.classes}"/> -->
      <classpath>
	<pathelement location="${build.classes}" />
	<fileset dir="${build.lib}">
	  <include name="xerces.jar"/>
	</fileset>
      </classpath>
    </java>
  </target>

  <!--    ==================================================== -->
  <!--                   Run testcases                         -->
  <!--    ==================================================== -->
  <target name="run-tests" depends="init, compile-tests" description="Run unit tests">
    <delete dir="${junit.results}"/>
    <mkdir dir="${junit.results}"/>
    <echo message="Running unit tests..."/>
    <junit printsummary="no" 
	   haltonerror="yes" 
	   haltonfailure="yes"
	   fork="yes">
      <!--        <classpath refid="tests-classpath" /> -->
      <!--        <sysproperty key="build.tests" value="${build.tests}"/> -->
      <classpath>
	<pathelement location="${build.classes}" />
	<fileset dir="${build.lib}">
	  <include name="xerces.jar"/>
	</fileset>
	<pathelement location="${build.tests}" />
	<pathelement path="${java.class.path}" />
      </classpath>
      <formatter type="plain" usefile="false" />
      <formatter type="xml" />
      <batchtest todir="${junit.results}" >
	<fileset dir="${tests.dir}">
	  <include name="**/*Test*" />
	</fileset>
      </batchtest>
    </junit>
  </target>
  
  <!--    ==================================================== -->
  <!--                 Create the qt.jar                       -->
  <!--    ==================================================== -->
  <target name="jar" depends="compile">
    <jar jarfile="${build.lib}/qt.jar"
	 basedir="${build.classes}"
	 manifest="${manifest}">
    </jar>
  </target>

  <!--  ====================================================== -->
  <!--             Create the API documentation               -->               
  <!--  ====================================================== -->
  <target name="javadoc_check">
    <uptodate property="javadoc.notrequired" targetfile="${build.javadocs}/packages.html" >
      <srcfiles dir= "${java.dir}" includes="**/*.java"/>
    </uptodate>
  </target>

  <target name="javadocs" depends="init, javadoc_check" 
	  unless="javadoc.notrequired"
	  description="Creates the API documentation">
    <mkdir dir="${build.javadocs}"/>
    <javadoc packagenames="edu.jach.qt.*"
	     sourcepath="${java.dir}"
	     destdir="${build.javadocs}"
	     author="true"
	     version="true"
	     windowtitle="${Name} API"
	     doctitle="${Name}"
	     bottom="Copyright &#169; 2001 Joint Astronomy Centre. All Rights Reserved.">
      <group title="QT Core" packages="edu.jach.qt*" />
    </javadoc>
  </target>

  <!--    ==================================================== -->
  <!--                     Clean It!                           -->
  <!--    ==================================================== -->
  <target name="clean">
    <delete dir="${build.dir}" />
    <delete dir="${build.lib}" />
  </target>

  <!--    ==================================================== -->
  <!--                     Clean Build!                        -->
  <!--    ==================================================== -->
  <target name="cleanbuild" 
	  depends="clean,masterbuild" 
	  description="Cruise control clean build">
  </target>

  <!--    ==================================================== -->
  <!--                       MAIN                              -->
  <!--    ==================================================== -->
  <target name="main" depends="jar">
    <!--      <antstructure output="project.dtd"/> -->
    <echo message="EVERYTHING LOOKS GOOD!"/>
    <echo message="Run /jac_sw/OMP/QT/bin/qt"/>
  </target>
  
</project>
