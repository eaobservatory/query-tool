<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE project PUBLIC "-//ANT//DTD project//EN" "misc/project.dtd" >

<project name="Omp" default="main" basedir=".">
  
  <!-- ==================================================== -->
  <!--             OMP -QT BUILD TOOL-                      -->
  <!-- ==================================================== -->
  <!--    <taskdef name="modificationset" classname="net.sourceforge.cruisecontrol.ModificationSet"/> -->
  <!--    <taskdef name="junit" classname="org.apache.tools.ant.taskdefs.optional.junit.JUnitTask" /> -->

  <!-- ================================================ -->
  <!--   Set the properties related to the source tree  -->
  <!-- ================================================ -->
  <!--    <property name="build.sysclasspath" value="first"/> -->

  <property name="masterbuild.logdir" value="/tmp/logs"/>
  <property name="junit.results" value="test-results" />

  <property name="Name" value="QT"/>
  <property name="name" value="qt"/>
  <tstamp>
	  <format property="version" pattern="_yyyyMMdd"/>
  </tstamp>
  <property name="src.dir" value="src"/>
  <property name="lib.dir" value="lib"/>
  <property name="config.dir" value="config"/>
  <property name="icons.dir" value="icons"/>
  <property name="bin.dir" value="bin"/>
  <property name="java.dir" value="${src.dir}/main"/>
  <property name="tests.dir" value="src/testcases"/>
  <property name="manifest" value="src/etc/manifest"/>
  
  <!--    ==================================================== -->
  <!--       Set the properties for the build area             -->
  <!--    ==================================================== -->
  <property name="build.dir" value="/tmp/install/omp/QT"/>
  <property name="build.classes" value="${build.dir}/classes"/>
  <property name="build.config" value="${build.dir}/config"/>
  <property name="build.icons" value="${build.dir}/icons"/>
  <property name="build.bin" value="${build.dir}/bin"/>
  <property name="build.lib" value="${build.dir}/lib"/>
  <property name="build.javadocs" value="${build.dir}/javadocs"/>
  <property name="build.tests" value="${build.dir}/testcases"/>

  <!--    ==================================================== -->
  <!--       Set the properties for the dist area             -->
  <!--    ==================================================== -->
  <property name="dist.dir" value="/tmp/install/jac_sw/omp/${Name}${version}"/>
  <property name="dist.classes" value="${dist.dir}/classes"/>
  <property name="dist.config" value="${dist.dir}/config"/>
  <property name="sys.dist.config" value="/jac_sw/omp/config"/>
  <property name="dist.icons" value="${dist.dir}/icons"/>
  <property name="dist.bin" value="${dist.dir}/bin"/>
  <property name="dist.lib" value="${dist.dir}/lib"/>
  <property name="dist.javadocs" value="${dist.dir}/javadocs"/>
  <property name="dist.tests" value="${dist.dir}/testcases"/>

  <!--    ==================================================== -->
  <!--       OT PATHS                                          -->
  <!--    ==================================================== -->
  <property name="ot.dir" value="/jac_sw/orac3/install"/>
  <property name="ot.lib.dir" value="${ot.dir}/lib"/>
  <property name="ot.tools.dir" value="${ot.dir}/tools"/>


  <path id="classpath">
  </path>
  
  <path id="runpath">
  </path>
  
  <path id="tests-classpath">
  </path>
  
  <!--    ==================================================== -->
  <!--                  Prepare the Build                      -->
  <!--    ==================================================== -->
  <target name="init">
    <tstamp />
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${build.classes}"/>
    <mkdir dir="${build.lib}"/>
    <mkdir dir="${build.icons}"/>
    <mkdir dir="${build.bin}"/>
    <mkdir dir="${build.config}"/>
    <mkdir dir="${masterbuild.logdir}"/>
  </target>

  <!--    ==================================================== -->
  <!--                  Prepare the Dist                      -->
  <!--    ==================================================== -->
  <target name="init-dist">
    <tstamp />
    <mkdir dir="${dist.dir}"/>
    <mkdir dir="${dist.classes}"/>
    <mkdir dir="${dist.lib}"/>
    <mkdir dir="${dist.icons}"/>
    <mkdir dir="${dist.bin}"/>
    <mkdir dir="${dist.config}"/>
    <mkdir dir="${masterbuild.logdir}"/>
  </target>

  <!--    ==================================================== -->
  <!--                  Check Dependencies                     -->
  <!--    ==================================================== -->
  <target name="mkdeps" depends="init">
    <depend srcdir="${java.dir}/"
	    destdir="${build.classes}"
	    cache="depcache"
	    closure="yes"/>
  </target>

  <!--    ==================================================== -->
  <!--                  Check Dependencies for Dist            -->
  <!--    ==================================================== -->
  <target name="mkdeps-dist" depends="init-dist">
    <depend srcdir="${java.dir}/"
	    destdir="${dist.classes}"
	    cache="depcache"
	    closure="yes"/>
  </target>

  <!--    ================================================ -->
  <!--                   Compile testcases                 -->
  <!--    ================================================ -->
  <target name="compile-tests" depends="compile">
    <mkdir dir="${build.tests}"/>

    <javac srcdir="${tests.dir}"
	   destdir="${build.tests}"
	   debug="${debug}"
	   target="1.6">
      <classpath>
	<pathelement location="${build.classes}" />
	<fileset dir="${build.lib}">
	  <include name="xerces.jar"/>
	</fileset>
      </classpath>

    </javac>
  </target>

  <!--    ====================================================
  *                             MasterBuild                          
  *       ==================================================== -->
  <target name="masterbuild" 
	  depends="compile,run-tests,jar"
	  description="Cruise control master build">
  </target>

  <!--    ==================================================== -->
  <!--                      Build It!                          -->
  <!--    ==================================================== -->
  <target name="compile" depends="mkdeps">
    <javac srcdir="${java.dir}/" 
	   destdir="${build.classes}" 
	   extdirs="${java.ext.dirs}"
	   deprecation="off"
	   debug="on"
	   target="1.6">
      <exclude name="edu/jach/qt/gui/MsbNode.java"/>
      <exclude name="edu/jach/qt/gui/DragDropObject.java"/>
      <exclude name="edu/jach/qt/gui/DnDJTree.java"/>
      <classpath>
	      <fileset dir="${lib.dir}">
		      <include name="*.jar"/>
	      </fileset>
	      <fileset dir="${ot.lib.dir}">
		      <include name="*.jar"/>
	      </fileset>
	      <pathelement location="/jac_sw/itsroot/install/dcHub/javalib/dcHub.jar" />
	      <pathelement location="/jac_sw/drama/CurrentRelease/javalib" />
	      <pathelement location="${ot.tools.dir}/pal.jar" />
      </classpath>
    </javac>

    <copy todir="${build.lib}">
      <fileset dir="${lib.dir}">
        <include name="*.jar" />
      </fileset>
    </copy>

    <copy todir="${build.config}">
      <fileset dir="${config.dir}">
        <include name="*" />
      </fileset>
    </copy>

    <copy todir="${build.icons}">
      <fileset dir="${icons.dir}">
        <include name="*" />
      </fileset>
    </copy>

    <copy todir="${build.bin}">
      <fileset dir="${bin.dir}">
        <include name="*" />
      </fileset>
    </copy>

    <chmod perm="+x">
      <fileset dir="${build.bin}">
        <include name="*" />
      </fileset>
    </chmod>

    <chmod dir="${build.dir}" perm="g+w" includes="**/*"/>

  </target>

  <!--    ==================================================== -->
  <!--                      Build It for Dist!                 -->
  <!--    ==================================================== -->
  <target name="compile-dist" depends="mkdeps-dist">
    <javac srcdir="${java.dir}/" 
	   destdir="${dist.classes}" 
	   extdirs="${java.ext.dirs}"
	   debug="on"
	   target="1.6">
      <exclude name="edu/jach/qt/gui/MsbNode.java"/>
      <exclude name="edu/jach/qt/gui/DragDropObject.java"/>
      <exclude name="edu/jach/qt/gui/DnDJTree.java"/>
      <classpath>
	      <fileset dir="${lib.dir}">
		      <include name="*.jar"/>
	      </fileset>
	      <fileset dir="${ot.lib.dir}">
		      <include name="*.jar"/>
	      </fileset>
	      <pathelement location="/jac_sw/itsroot/install/dcHub/javalib/dcHub.jar" />
	      <pathelement location="/jac_sw/drama/CurrentRelease/javalib" />
	      <pathelement location="${ot.tools.dir}/pal.jar" />
      </classpath>
    </javac>

    <copy todir="${dist.lib}">
      <fileset dir="${lib.dir}">
        <include name="*.jar" />
      </fileset>
    </copy>

    <copy todir="${dist.config}">
      <fileset dir="${config.dir}">
        <include name="*" />
      </fileset>
    </copy>

    <copy todir="${sys.dist.config}">
      <fileset dir="${config.dir}">
        <include name="*" />
      </fileset>
    </copy>

    <copy todir="${dist.icons}">
      <fileset dir="${icons.dir}">
        <include name="*" />
      </fileset>
    </copy>

    <copy todir="${dist.bin}">
      <fileset dir="${bin.dir}">
        <include name="qt" />
      </fileset>
    </copy>

    <chmod perm="+x">
      <fileset dir="${dist.bin}">
        <include name="*" />
      </fileset>
    </chmod>
  </target>

  <!--    ==================================================== -->
  <!--                     Run It!                             -->
  <!--    ==================================================== -->
  <target name="run" depends="compile">
    <java classname="edu.jach.qt.app.Main" fork="yes">
      <classpath>
	<pathelement location="${build.classes}" />
	<fileset dir="${build.lib}">
	  <include name="xerces.jar"/>
	</fileset>
      </classpath>
    </java>
  </target>

  <!--    ==================================================== -->
  <!--                   Run testcases                         -->
  <!--    ==================================================== -->
  <target name="run-tests" depends="init, compile-tests" description="Run unit tests">
    <delete dir="${junit.results}"/>
    <mkdir dir="${junit.results}"/>
    <echo message="Running unit tests..."/>
    <junit printsummary="no" 
	   haltonerror="yes" 
	   haltonfailure="yes"
	   fork="yes">
      <!--        <classpath refid="tests-classpath" /> -->
      <!--        <sysproperty key="build.tests" value="${build.tests}"/> -->
      <classpath>
	<pathelement location="${build.classes}" />
	<fileset dir="${build.lib}">
	  <include name="xerces.jar"/>
	</fileset>
	<pathelement location="${build.tests}" />
	<pathelement path="${java.class.path}" />
      </classpath>
      <formatter type="plain" usefile="false" />
      <formatter type="xml" />
      <batchtest todir="${junit.results}" >
	<fileset dir="${tests.dir}">
	  <include name="**/*Test*" />
	</fileset>
      </batchtest>
    </junit>
  </target>
  
  <!--    ==================================================== -->
  <!--                 Create the qt.jar                       -->
  <!--    ==================================================== -->
  <target name="jar" depends="compile">
    <jar jarfile="${build.lib}/qt.jar">
      <fileset dir="${build.classes}"/>
      <fileset dir="${icons.dir}"/>
      <!--  manifest="${manifest}"> -->
    </jar>
  </target>

  <!--    ==================================================== -->
  <!--                 Create the qt.jar                       -->
  <!--    ==================================================== -->
  <target name="jar-dist" depends="compile-dist">
    <jar jarfile="${dist.lib}/qt.jar"
	 basedir="${dist.classes}"
	 manifest="${manifest}">
    </jar>
  </target>

  <!--  ====================================================== -->
  <!--             Create the API documentation               -->               
  <!--  ====================================================== -->
  <target name="javadoc_check">
    <uptodate property="javadoc.notrequired" targetfile="${dist.javadocs}/packages.html" >
      <srcfiles dir= "${java.dir}" includes="**/*.java"/>
    </uptodate>
  </target>

  <target name="javadocs" depends="init, javadoc_check" 
	  unless="javadoc.notrequired"
	  description="Creates the API documentation">
    <mkdir dir="${dist.javadocs}"/>
    <javadoc packagenames="edu.jach.qt.*"
	     sourcepath="${java.dir}"
	     destdir="${dist.javadocs}"
	     author="true"
	     version="true"
	     windowtitle="${Name} API"
	     doctitle="${Name}"
	     bottom="Copyright &#169; 2001 Joint Astronomy Centre. All Rights Reserved.">
      <group title="QT Core" packages="edu.jach.qt*" />
    </javadoc>
  </target>

  <!--    ==================================================== -->
  <!--                     Clean It!                           -->
  <!--    ==================================================== -->
  <target name="clean" description="The default clean target. Deletes the install tree.">
    <delete dir="${build.dir}" />
    <delete dir="${build.lib}" />
  </target>

  <!--    ==================================================== -->
  <!--                     Clean It!                           -->
  <!--    ==================================================== -->
  <target name="dist-clean" description="The dist clean target. Deletes the dist install tree.">
    <delete dir="${dist.dir}" />
    <delete dir="${dist.lib}" />
  </target>

  <!--    ==================================================== -->
  <!--                     Clean Build!                        -->
  <!--    ==================================================== -->
  <target name="cleanbuild" 
	  depends="clean,masterbuild" 
	  description="Cruise control clean build">
  </target>

  <!--    ==================================================== -->
  <!--                       MAIN                              -->
  <!--    ==================================================== -->
  <target name="main" depends="jar" description="The default target built when no args passed to ant.">
    <!--      <antstructure output="project.dtd"/> -->
    <echo message="EVERYTHING LOOKS GOOD!"/>
    <echo message="Run ${build.dir}/bin/qt"/>
  </target>

  <!--    ==================================================== -->
  <!--                       DIST                              -->
  <!--    ==================================================== -->
  <target name="dist" depends="jar-dist">
    <echo message="EVERYTHING LOOKS GOOD!"/>
    <echo message="Run ${dist.dir}/bin/qt"/>
  </target>
  
</project>
